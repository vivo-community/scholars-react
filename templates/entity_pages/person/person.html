<vivo-person-navigation></vivo-person-navigation>
<%
  let person = data["person"]
%>
<div class="container">

   <aside>
      <vivo-sidebar>
         <%= if (person["thumbnail"]) { %>
         <!-- FIXME: should get base image path some other way -->
         <img class="profile-image" src="<%= ThemeVariable("baseImageUrl") %><%= person["thumbnail"] %>" />
         <% } else { %>
         <img class="profile-image" src="<%= assetPath("images/" + ThemeVariable("defaultProfileImage")) %>" />
         <% } %>
         <%= if (person["primaryEmail"] || person["phone"] || person["streetAddress"]) { %>
         <vivo-sidebar-item>
            <h3 slot="heading"><%= t("profile_contact") %></h3>
               <%= if (person["primaryEmail"]) { %>
              <div slot="content">
               <h4><%= t("email") %></h4>
               <span><%= person["primaryEmail"] %></span>
              </div>
               <% } %>
               <%= if (person["phone"]) { %>
              <div slot="content">
               <h4><%= t("telephone") %></h4>
               <span><%= person["phone"] %></span>
              </div>
               <% } %>
               <%= if (person["streetAddress"]) { %>
              <div slot="content">
               <h4><%= t("address_1") %></h4>
               <div><%= person["streetAddress"] %></div>
              </div>
               <% } %>
         </vivo-sidebar-item>
         <% } %>
         <%= if (person["websites"]) { %>
         <vivo-sidebar-item>
            <h3 slot="heading"><%= t("profile_professional_links") %></h3>
             <% let websites = person["websites"] %>
             <% SortByStringField(websites, "label") %>
             <%= for (w) in websites { %>
             <div slot="content" class="website">
                <a class="prof-link" href="<%= w["url"] %>">
                   <%= w["label"] %>
                </a>
             </div>
             <% } %>
         </vivo-sidebar-item>
         <% } %>

         <%= if (person["researchAreas"]) { %>
           <vivo-sidebar-item>
            <h3 slot="heading"><%= t("keywords") %></h3>
            <% let researchAreas = person["researchAreas"] %>
             <% SortByStringField(researchAreas, "label") %>
            <%= for (k) in researchAreas { %>
            <div slot="content">
              <a href="/entities/concepts/<%= k["id"] %>">
                <%= k["label"] %>
              </a>
            </div>
            <% } %>
          </vivo-sidebar>
      <% } %>
   </aside>

   <main>
      <h2 class="page-title"><%= person["name"] %></h2>
      <h2 class="page-subtitle"><%= person["preferredTitle"] %></h2>
      <!-- tabs -->
      <vivo-tabs>
         <%= if (person["overview"] || person["positions"] || person["educationAndTraining"]) { %>
         <vivo-tab id="about-tab">
            <h3><%= t("about") %></h3>
         </vivo-tab>
         <vivo-tab-panel id="about-panel">
            <%= if (person["overview"]) { %>
            <h4 class="section-title"><%= t("overview") %></h4>
            <div>
               <%= raw(person["overview"]) %>
            </div>
            <% } %>

            <%= if (person["positions"] && len(person["positions"]) > 0) { %>
            <h4 class="section-title"><%= t("profile_current_appointments") %></h4>
            <section>
               <% let positions = person["positions"] %>
               <% SortByGraphqlDateFieldDesc(positions, "dateTimeIntervalStart") %>
               <%= for (p) in positions { %>
               <div class="position">
                  <div class="position-title"><%= p["title"] %></div>
                  <%= if (p["organization"]) { %>
                     <!-- NOTE: this should probably just be one, but is array -->
                     <%= for (o) in p["organization"] { %>
                        <span class="position-organization"><%= o["label"] %></span>
                     <% } %>
                  <% } %>
                  <vivo-interval interval-start="<%= FormatGraphqlDate(p["dateTimeIntervalStart"], "year") %>" interval-end="<%= FormatGraphqlDate(p["dateTimeIntervalEnd"], "year") %>" separate-open></vivo-interval>
               </div>
               <% } %>
            </section>
            <% } %>

            <%= if (person["educationAndTraining"]) { %>
            <h4 class="section-title"><%= t("education") %></h4>
            <section>
               <% let educations = person["educationAndTraining"] %>
               <%= SortByISODateFieldDesc(educations, "endDate") %>
               <%= for (e) in educations { %>
               <div class="education">
                  <div class="education-organization">
                  <%= if (e["organization"]) { %>
                    <%= e["organization"]["label"] %>
                  <% } %>
                  </div>
                  <%= e["abbreviation"] %>
                  <%= e["field"] %>
                  <vivo-interval interval-start="<%= FormatISODate(e["startDate"], "year") %>" interval-end="<%= FormatISODate(e["endDate"], "year") %>"></vivo-interval>
               </div>
               <% } %>
            </section>
            <% } %>
         </vivo-tab-panel>
         <% } %>

         <%= if (person["publications"]) { %>
         <vivo-tab id="publications-tab">
            <h3><%= t("tab_publications") %></h3>
         </vivo-tab>
         <vivo-tab-panel id="publications-panel">
            <vivo-publication-list>
               <%= for (idx, p) in person["publications"] { %>
               <vivo-publication publication-url="/entities/publication/<%= p["id"] %>" published-date="<%= p["publicationDate"] %>">
                  <a slot="title" href="/entities/publication/<%= p["id"] %>">
                    <%= p["title"] %>
                  </a>
                  <vivo-publication-author-list slot="authors">
                     <%= for (a) in p["authors"] { %>
                     <vivo-publication-author profile-url="/entities/person/<%= a["id"] %>">
                        <%= a["label"] %>
                     </vivo-publication-author>
                     <% } %>
                  </vivo-publication-author-list>
                  <%= if (p["publisher"]) { %>
                  <span slot="publisher">
                     <span><%= p["publisher"]["label"] %></span>
                  </span>
                  <% } %>
                  <%= if (p["publicationDate"]) { %>
                    <span slot="date"><%= FormatGraphqlDate(p["publicationDate"],"yearMonthDay") %></span>
                  <% } %>
                  <%= if (p["abstractText"]) { %>
                  <vivo-truncated-text slot="abstract">
                    <%= raw(p["abstractText"]) %>
                  </vivo-truncated-text>
                  <% } %>
               </vivo-publication>
               <% } %>
            </vivo-publication-list>
         </vivo-tab-panel>
         <% } %>


         <%= if (person["courses"]) { %>
         <vivo-tab id="teaching-tab">
            <h3><%= t("tab_teaching") %></h3>
         </vivo-tab>
         <vivo-tab-panel id="teaching-panel">
            <h4 class="section-title"><%= t("courses") %></h4>
         </vivo-tab-panel>
         <% } %>
      </vivo-tabs>

   </main>

</div><!-- end container -->
<%= javascriptTag("person.js") %>
